export function define(t){let e=t.is;customElements.get(e)?console.warn("Already registered "+e):customElements.define(e,t)}export const disabled="disabled";export function XtallatX(t){return class extends t{constructor(){super(...arguments),this._evCount={}}static get observedAttributes(){return[disabled]}get disabled(){return this._disabled}set disabled(t){this.attr(disabled,t,"")}attr(t,e,n){this[(e?"set":"remove")+"Attribute"](t,n||e)}to$(t){const e=t%2;return(t-e)/2+"-"+e}incAttr(t){const e=this._evCount;t in e?e[t]++:e[t]=0,this.attr("data-"+t,this.to$(e[t]))}attributeChangedCallback(t,e,n){switch(t){case disabled:this._disabled=null!==n}}de(t,e,n=!1){const s=t+(n?"":"-changed"),i=new CustomEvent(s,{detail:e,bubbles:!0,composed:!1});return this.dispatchEvent(i),this.incAttr(s),i}_upgradeProperties(t){t.forEach(t=>{if(this.hasOwnProperty(t)){let e=this[t];delete this[t],this[t]=e}})}}}export function getHost(t){let e=t;for(;e=e.parentNode;){if(11===e.nodeType)return e.host;if(e.tagName.indexOf("-")>-1)return e;if("BODY"===e.tagName)return null}return null}import{getHost}from"xtal-element/getHost.js";export const history_state_update="history-state-update";function getIFrmWin(t,e){let n=t.querySelector("iframe[xtal-state]");return null===n?((n=document.createElement("iframe")).setAttribute("xtal-state",""),n.addEventListener("load",()=>{n.setAttribute("loaded",""),null!==e&&e(n)}),n.src="blank.html",n.style.display="none",t.appendChild(n)):n.hasAttribute("loaded")?null!==e&&e(n):n.addEventListener("load",()=>{null!==e&&e(n)}),n.contentWindow}function getMchPar(t,e){let n=t.parentElement;for(;n;){if(n.matches(e))return n;n=n.parentElement}}function getSC(t){const e=getHost(t);return null===e.shadowRoot?e:e.shadowRoot}export function getWinCtx(t,e){return new Promise((n,s)=>{switch(e){case"global":init(self),n(self);break;case"local":getIFrmWin(t.parentElement,t=>{init(t.contentWindow),n(t.contentWindow)});break;case"shadow":getIFrmWin(getSC(t),t=>{init(t.contentWindow),n(t.contentWindow)});break;default:getIFrmWin(getMchPar(t,e),t=>{init(t.contentWindow),n(t.contentWindow)})}})}function de(t,e){const n={oldState:t,newState:e.history.state,initVal:!1},s=e.__xtalStateInfo;s.hasStarted||(s.hasStarted=!0,s.startedAsNull&&(n.initVal=!0));const i=new CustomEvent(history_state_update,{detail:n,bubbles:!0,composed:!0});e.dispatchEvent(i)}function init(t){if(t.__xtalStateInit)return;t.__xtalStateInit=!0,t.__xtalStateInfo||(t.__xtalStateInfo={startedAsNull:null===t.history.state});const e=t.history.pushState.bind(t.history);t.history.pushState=function(n,s,i){const a=t.history.state;e(n,s,i),de(a,t)};const n=t.history.replaceState.bind(t.history);t.history.replaceState=function(e,s,i){const a=t.history.state;n(e,s,i),de(a,t)}}