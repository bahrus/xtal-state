!function(){const t="disabled";const e="history-state-update";function s(t,e){let s=t.querySelector("iframe[xtal-state]");return null===s?((s=document.createElement("iframe")).setAttribute("xtal-state",""),s.addEventListener("load",()=>{s.setAttribute("loaded",""),null!==e&&e(s)}),s.src="blank.html",s.style.display="none",t.appendChild(s)):s.hasAttribute("loaded")?null!==e&&e(s):s.addEventListener("load",()=>{null!==e&&e(s)}),s.contentWindow}function n(t,s){const n={oldState:t,newState:s.history.state,initVal:!1},i=s.__xtalStateInfo;i.hasStarted||(i.hasStarted=!0,i.startedAsNull&&(n.initVal=!0));const r=new CustomEvent(e,{detail:n,bubbles:!0,composed:!0});s.dispatchEvent(r)}function i(t){if(t.__xtalStateInit)return;t.__xtalStateInit=!0,t.__xtalStateInfo||(t.__xtalStateInfo={startedAsNull:null===t.history.state});const e=t.history.pushState.bind(t.history);t.history.pushState=function(s,i,r){const a=t.history.state;e(s,i,r),n(a,t)};const s=t.history.replaceState.bind(t.history);t.history.replaceState=function(e,i,r){const a=t.history.state;s(e,i,r),n(a,t)}}const r="level";class a extends(function(e){return class extends e{constructor(){super(...arguments),this._evCount={}}static get observedAttributes(){return[t]}get disabled(){return this._disabled}set disabled(e){this.attr(t,e,"")}attr(t,e,s){this[(e?"set":"remove")+"Attribute"](t,s||e)}to$(t){const e=t%2;return(t-e)/2+"-"+e}incAttr(t){const e=this._evCount;t in e?e[t]++:e[t]=0,this.attr("data-"+t,this.to$(e[t]))}attributeChangedCallback(e,s,n){switch(e){case t:this._disabled=null!==n}}de(t,e,s=!1){const n=t+(s?"":"-changed"),i=new CustomEvent(n,{detail:e,bubbles:!0,composed:!1});return this.dispatchEvent(i),this.incAttr(n),i}_upgradeProperties(t){t.forEach(t=>{if(this.hasOwnProperty(t)){let e=this[t];delete this[t],this[t]=e}})}}}(HTMLElement)){constructor(){super(...arguments),this._level="global"}get level(){return this._level}set level(t){this.attr(r,t)}static get observedAttributes(){return super.observedAttributes.concat([r])}get window(){return this._window}attributeChangedCallback(t,e,s){switch(super.attributeChangedCallback(t,e,s),t){case r:this._level=s}this.onPropsChange()}connectedCallback(){this.style.display="none",this._upgradeProperties(["disabled",r]),this._conn=!0,this.onPropsChange()}onPropsChange(){return!(this._conn&&!this._disabled)||(this._window||(this._notReady=!0,(t=this,e=this._level,new Promise((n,r)=>{switch(e){case"global":i(self),n(self);break;case"local":s(t.parentElement,t=>{i(t.contentWindow),n(t.contentWindow)});break;case"shadow":s(function(t){const e=function(t){let e=t;for(;e=e.parentNode;){if(11===e.nodeType)return e.host;if("BODY"===e.tagName)return null}return null}(t);return null===e.shadowRoot?e:e.shadowRoot}(t),t=>{i(t.contentWindow),n(t.contentWindow)});break;default:s(function(t,e){let s=t.parentElement;for(;s;){if(s.matches(e))return s;s=s.parentElement}}(t,e),t=>{i(t.contentWindow),n(t.contentWindow)})}})).then(t=>{this._window=t,this._notReady=!1})),!!this._notReady||void 0);var t,e}}const o="with-url-pattern",l="parse",h="init-history-if-null";class u extends a{constructor(){super(...arguments),this._checkedNull=!1}static get is(){return"xtal-state-parse"}static get observedAttributes(){return super.observedAttributes.concat([o,l,h])}attributeChangedCallback(t,e,s){switch(super.attributeChangedCallback(t,e,s),t){case o:this._withURLPattern=s;break;case l:this["_"+t]=s;break;default:return void super.attributeChangedCallback(t,e,s)}this.onParsePropsChange()}get withURLPattern(){return this._withURLPattern}set withURLPattern(t){this.attr(o,t)}get parse(){return this._parse}set parse(t){this.attr(l,t)}get parseFn(){return this._parseFn}set parseFn(t){this._parseFn=t,this.onParsePropsChange()}get initHistoryIfNull(){return this._initHistoryIfNull}set initHistoryIfNull(t){this.attr(h,t,"")}connectedCallback(){this._upgradeProperties(["withURLPattern",l,"initHistoryIfNull","parseFn"]),super.connectedCallback(),this.onParsePropsChange()}onPropsChange(){return!this._initHistoryIfNull&&super.onPropsChange()}get noMatch(){return this._noMatch}set noMatch(t){this._noMatch=t,this.attr("no-match",t.toString())}onParsePropsChange(){if(this._disabled||this.value||this.noMatch)return;if(!this._window)return void setTimeout(()=>{this.onParsePropsChange()},50);this._checkedNull||(null===this._window.history.state&&(this.dataset.historyWasNull="true"),this._checkedNull=!0);let t=null;if(this._withURLPattern&&-1===(t=u.parseAddressBar(this._parse,this._withURLPattern,this._window))){if(!this._parseFn)return;const e=u.getObj(this._parse,this._window);t=this._parseFn(e,this)}if(null===t)return this.noMatch=!0,void this.de("no-match-found",{value:!0},!0);this.value=t,this.de("match-found",{value:t},!0),this._initHistoryIfNull&&null!==this._window.history.state&&this._window.history.replaceState(t,"",this._window.location.href)}static getObj(t,e){let s=e;return t.split(".").forEach(t=>{s&&(s=s[t])}),s}static parseAddressBar(t,e,s){try{const n=new RegExp(e);let i=this.getObj(t,s);const r=n.exec(i);return r?r.groups:null}catch(t){return-1}}}!function(t){let e=t.is;customElements.get(e)?console.warn("Already registered "+e):customElements.define(e,t)}(u)}();