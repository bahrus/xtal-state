!function(){function t(t){let e=t.is;customElements.get(e)?console.warn("Already registered "+e):customElements.define(e,t)}const e=(t,e)=>{let s;return function(){clearTimeout(s),s=setTimeout(()=>t.apply(this,arguments),e)}},s="disabled";const i="with-path";function r(t){return class extends t{get withPath(){return this._withPath}set withPath(t){this.setAttribute(i,t)}wrap(t){if(this._withPath){let e={};return function(t,e,s,i){const r=e.shift(),a=t[r],n={[r]:a||{}};let h=n[r];const o=e.pop();if(e.forEach(t=>{let e=h[t];e||(e=h[t]={}),h=e}),h[o]&&"object"==typeof s?Object.assign(h[o],s):void 0===o?n[r]=s:h[o]=s,i)try{Object.assign(t,n)}catch(t){}}(e,this._withPath.split("."),t,!0),e}return t}}}const a="level";class n extends(function(t){return class extends t{constructor(){super(...arguments),this._evCount={}}static get observedAttributes(){return[s]}get disabled(){return this._disabled}set disabled(t){this.attr(s,t,"")}attr(t,e,s){this[(e?"set":"remove")+"Attribute"](t,s||e)}to$(t){const e=t%2;return(t-e)/2+"-"+e}incAttr(t){const e=this._evCount;t in e?e[t]++:e[t]=0,this.attr("data-"+t,this.to$(e[t]))}attributeChangedCallback(t,e,i){switch(t){case s:this._disabled=null!==i}}de(t,e,s=!1){const i=t+(s?"":"-changed"),r=new CustomEvent(i,{detail:e,bubbles:!0,composed:!1});return this.dispatchEvent(r),this.incAttr(i),r}_upgradeProperties(t){t.forEach(t=>{if(this.hasOwnProperty(t)){let e=this[t];delete this[t],this[t]=e}})}}}(HTMLElement)){constructor(){super(...arguments),this._level="global"}get level(){return this._level}set level(t){this.attr(a,t)}static get observedAttributes(){return super.observedAttributes.concat([a])}get window(){return this._window}attributeChangedCallback(t,e,s){switch(super.attributeChangedCallback(t,e,s),t){case a:this._level=s}this.onPropsChange()}connectedCallback(){this.style.display="none",this._upgradeProperties(["disabled",a]),this._conn=!0,this.onPropsChange()}onPropsChange(){return!(this._conn&&!this._disabled)||(this._window||(this._notReady=!0,getWinCtx(this,this._level).then(t=>{this._window=t,this._notReady=!1})),!!this._notReady||void 0)}}const h="url",o="url-search",l="replace-url-value";const c="make",u="rewrite",d="history",_="title",p="new";class b extends(function(t){return class extends t{get url(){return this._url}set url(t){this.attr(h,t)}get urlSearch(){return this._urlSearch}set urlSearch(t){this.attr(o,t)}get replaceUrlValue(){return this._replaceUrlValue}set replaceUrlValue(t){this.attr(l,t)}get stringifyFn(){return this._stringifyFn}set stringifyFn(t){this._stringifyFn=t}static get UFAttribs(){return[h,o,l]}attributeChangedCallback(t,e,s){switch(t){case h:this["_"+t]=s;break;case o:this._urlSearch=s;break;case l:this._replaceUrlValue=s}super.attributeChangedCallback&&super.attributeChangedCallback(t,e,s)}connectedCallback(){this._upgradeProperties([h,"urlSearch","replaceUrlValue","stringifyFn"]),super.connectedCallback&&super.connectedCallback()}adjustUrl(t){if(this._stringifyFn)t=this._stringifyFn(this);else if(this._replaceUrlValue&&this._urlSearch){const e=new RegExp(this._urlSearch);t=t.replace(e,this._replaceUrlValue)}return t}}}(r(n))){constructor(){super(...arguments),this._title=""}static get is(){return"xtal-state-commit"}get make(){return this._make}set make(t){this.attr(c,t,"")}get rewrite(){return this._rewrite}set rewrite(t){this.attr(u,t,"")}get history(){return this._window.history.state}set history(t){this._history=t,this.onPropsChange()}get title(){return this._title}set title(t){this.attr(_,t)}get new(){return this._new}set new(t){this.attr(p,t,"")}static get observedAttributes(){return super.observedAttributes.concat(super.UFAttribs).concat([c,u,_,i,p])}attributeChangedCallback(t,e,s){switch(t){case p:case u:case c:this["_"+t]=null!==s;break;case _:this["_"+t]=s;break;case i:this._withPath=s}super.attributeChangedCallback(t,e,s)}connectedCallback(){this._upgradeProperties([c,u,_,"withPath","stringifyFn",p,"syncHistory"].concat([d])),this._debouncer=e(()=>{this.updateHistory()},50),super.connectedCallback()}onPropsChange(){if(!this._disabled)return super.onPropsChange()?!this._notReady||void setTimeout(()=>{this.onPropsChange()},50):!this._make&&!this._rewrite||void this._debouncer()}mergedHistory(){if(void 0!==this._history)return this.wrap(this._history)}updateHistory(){const t=this._new?{}:this.mergedHistory();if(null==t)return;const e=this.make?"push":"replace";if(this.value=t,this._disabled=!0,this.de("history",{value:t}),this._disabled=!1,this.make&&!this.url)return;let s=this._url;if(s&&!this._new||this._replaceUrlValue&&!this._new||(s=this._window.location.href),!s)return null;null!==(s=this.adjustUrl(s))&&this._window.history[e+"State"](t,this._title,s)}}t(b);t(class extends b{static get is(){return"xtal-state-update"}mergedHistory(){const t=super.mergedHistory();if(void 0!==t)return null===this._window.history.state?t:function t(e,s){if("object"==typeof e&&"object"==typeof s){for(const i in s){const r=s[i],a=e[i];if(r)if(a)switch(typeof r){case"object":switch(typeof a){case"object":t(a,r);break;default:e[i]=r}break;default:e[i]=r}else e[i]=r}return e}}(Object.assign({},this._window.history.state),this.wrap(this._history))}});const w="watch",g="all",y="popstate";t(class extends n{static get is(){return"xtal-state-watch"}static get observedAttributes(){return super.observedAttributes.concat([w])}attributeChangedCallback(t,e,s){switch(super.attributeChangedCallback(t,e,s),t){case w:this._watch=""===s?g:y}this.notify()}pushReplaceHandler(t){const e=this._window;t.detail.newState&&e.__xtalStateInfo.startedAsNull&&!e.__xtalStateInfo.hasStarted?(e.__xtalStateInfo.hasStarted,this.dataset.popstate="true"):delete this.dataset.popstate,this.history=this._window.history.state}popStateHandler(t){this.dataset.popstate="true",this.history=this._window.history.state}addSubscribers(){if(this._notReady)return void setTimeout(()=>{this.addSubscribers()},50);const t=this._window;switch(t.__xtalStateInfo||(t.__xtalStateInfo={startedAsNull:null===t.history.state}),this._watch){case g:case y:this._boundPushReplaceListener||(this._boundPushReplaceListener=this.pushReplaceHandler.bind(this),this._window.addEventListener(history_state_update,this._boundPushReplaceListener))}switch(this._watch){case y:this._boundPopStateListener||(this._boundPopStateListener=this.popStateHandler.bind(this),this._window.addEventListener(y,this._boundPopStateListener))}this._connected=!0,this.history=this._window.history.state}connectedCallback(){this._upgradeProperties([w]),super.connectedCallback(),this.addSubscribers()}disconnect(){this._boundPopStateListener&&this.removeEventListener(y,this._boundPopStateListener),this._boundPushReplaceListener&&this.removeEventListener(history_state_update,this._boundPushReplaceListener)}disconnectedCallback(){this.disconnect()}get history(){return this._history}set history(t){this._history=t,this._watch&&this.notify()}get watch(){return this._watch}set watch(t){this.attr(w,t)}notify(){this._watch&&!this._disabled&&this._connected&&void 0!==this._history&&null!==this._history&&this.de("history",{value:this._history})}});const f="with-url-pattern",C="parse",P="init-history-if-null";class v extends n{constructor(){super(...arguments),this._checkedNull=!1}static get is(){return"xtal-state-parse"}static get observedAttributes(){return super.observedAttributes.concat([f,C,P])}attributeChangedCallback(t,e,s){switch(super.attributeChangedCallback(t,e,s),t){case f:this._withURLPattern=s;break;case C:this["_"+t]=s;break;default:return void super.attributeChangedCallback(t,e,s)}this.onParsePropsChange()}get withURLPattern(){return this._withURLPattern}set withURLPattern(t){this.attr(f,t)}get parse(){return this._parse}set parse(t){this.attr(C,t)}get parseFn(){return this._parseFn}set parseFn(t){this._parseFn=t,this.onParsePropsChange()}get initHistoryIfNull(){return this._initHistoryIfNull}set initHistoryIfNull(t){this.attr(P,t,"")}connectedCallback(){this._upgradeProperties(["withURLPattern",C,"initHistoryIfNull","parseFn"]),super.connectedCallback(),this.onParsePropsChange()}onPropsChange(){return!this._initHistoryIfNull&&super.onPropsChange()}get noMatch(){return this._noMatch}set noMatch(t){this._noMatch=t,this.attr("no-match",t.toString())}onParsePropsChange(){if(this._disabled||this.value||this.noMatch)return;if(!this._window)return void setTimeout(()=>{this.onParsePropsChange()},50);this._checkedNull||(null===this._window.history.state&&(this.dataset.historyWasNull="true"),this._checkedNull=!0);let t=null;if(this._withURLPattern&&-1===(t=v.parseAddressBar(this._parse,this._withURLPattern,this._window))){if(!this._parseFn)return;const e=v.getObj(this._parse,this._window);t=this._parseFn(e,this)}if(null===t)return this.noMatch=!0,void this.de("no-match-found",{value:!0},!0);this.value=t,this.de("match-found",{value:t},!0),this._initHistoryIfNull&&null!==this._window.history.state&&this._window.history.replaceState(t,"",this._window.location.href)}static getObj(t,e){let s=e;return t.split(".").forEach(t=>{s&&(s=s[t])}),s}static parseAddressBar(t,e,s){try{const i=new RegExp(e);let r=this.getObj(t,s);const a=i.exec(r);return a?a.groups:null}catch(t){return-1}}}t(v)}();