import{XtalStateBase}from"./xtal-state-base.js";import{define}from"./node_modules/xtal-latx/define.js";var watch="watch",xtal_subscribers="xtal-subscribers";export var XtalStateWatch=function(_XtalStateBase){babelHelpers.inherits(XtalStateWatch,_XtalStateBase);babelHelpers.createClass(XtalStateWatch,null,[{key:"is",get:function get(){return"xtal-state-watch"}}]);function XtalStateWatch(){babelHelpers.classCallCheck(this,XtalStateWatch);return babelHelpers.possibleConstructorReturn(this,(XtalStateWatch.__proto__||Object.getPrototypeOf(XtalStateWatch)).call(this))}babelHelpers.createClass(XtalStateWatch,[{key:"attributeChangedCallback",value:function attributeChangedCallback(name,oldValue,newValue){babelHelpers.get(XtalStateWatch.prototype.__proto__||Object.getPrototypeOf(XtalStateWatch.prototype),"attributeChangedCallback",this).call(this,name,oldValue,newValue);switch(name){case watch:this._watch=null!==newValue;break;}this.notify()}},{key:"addSubscribers",value:function addSubscribers(){var _this=this;if(this._notReady){setTimeout(function(){_this.addSubscribers()},50);return}var win=this._window;if(!win[xtal_subscribers]){win[xtal_subscribers]=[];var originalPushState=win.history.pushState,boundPushState=originalPushState.bind(win.history);win.history.pushState=function(newState,title,URL){boundPushState(newState,title,URL);win[xtal_subscribers].forEach(function(subscriber){subscriber.history=newState})};var originalReplaceState=win.history.replaceState,boundReplaceState=originalReplaceState.bind(win.history);win.history.replaceState=function(newState,title,URL){boundReplaceState(newState,title,URL);win[xtal_subscribers].forEach(function(subscriber){subscriber.history=newState})};win.addEventListener("popstate",function(){win[xtal_subscribers].forEach(function(subscriber){subscriber.history=history.state})})}this._window[xtal_subscribers].push(this);this._connected=!0;this.history=this._window.history.state}},{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(XtalStateWatch.prototype.__proto__||Object.getPrototypeOf(XtalStateWatch.prototype),"connectedCallback",this).call(this);this.addSubscribers()}},{key:"notify",value:function notify(){if(!this._watch||this._disabled||!this._connected||this._history===void 0)return;this.de("history",{value:this._history})}},{key:"history",get:function get(){return this._history},set:function set(newVal){this._history=newVal;if(this._watch)this.notify()}},{key:"watch",get:function get(){return this._watch},set:function set(newVal){this.attr(watch,newVal,"")}}],[{key:"observedAttributes",get:function get(){return babelHelpers.get(XtalStateWatch.__proto__||Object.getPrototypeOf(XtalStateWatch),"observedAttributes",this).concat([watch])}}]);return XtalStateWatch}(XtalStateBase);define(XtalStateWatch);